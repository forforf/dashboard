(function() {
  var delay, foo, iced, multi, __iced_k, __iced_k_noop,
    __slice = [].slice,
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  iced = require('iced-coffee-script').iced;
  __iced_k = __iced_k_noop = function() {};

  delay = function(cb, i) {
    i = i || 3;
    return setTimeout(cb, i);
  };

  atest("basic iced waiting", function(cb) {
    var i, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    i = 1;
    (function(__iced_k) {
      __iced_deferrals = new iced.Deferrals(__iced_k, {
        parent: ___iced_passed_deferral,
        filename: "test/iced.coffee"
      });
      delay(__iced_deferrals.defer({
        lineno: 7
      }));
      __iced_deferrals._fulfill();
    })(function() {
      i++;
      return cb(i === 2, {});
    });
  });

  foo = function(i, cb) {
    var ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    (function(__iced_k) {
      __iced_deferrals = new iced.Deferrals(__iced_k, {
        parent: ___iced_passed_deferral,
        filename: "test/iced.coffee",
        funcname: "foo"
      });
      delay(__iced_deferrals.defer({
        lineno: 12
      }), i);
      __iced_deferrals._fulfill();
    })(function() {
      return cb(i);
    });
  };

  atest("basic iced waiting", function(cb) {
    var i, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    i = 1;
    (function(__iced_k) {
      __iced_deferrals = new iced.Deferrals(__iced_k, {
        parent: ___iced_passed_deferral,
        filename: "test/iced.coffee"
      });
      delay(__iced_deferrals.defer({
        lineno: 17
      }));
      __iced_deferrals._fulfill();
    })(function() {
      i++;
      return cb(i === 2, {});
    });
  });

  atest("basic iced trigger values", function(cb) {
    var i, j, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    i = 10;
    (function(__iced_k) {
      __iced_deferrals = new iced.Deferrals(__iced_k, {
        parent: ___iced_passed_deferral,
        filename: "test/iced.coffee"
      });
      foo(i, __iced_deferrals.defer({
        assign_fn: (function() {
          return function() {
            return j = arguments[0];
          };
        })(),
        lineno: 24
      }));
      __iced_deferrals._fulfill();
    })(function() {
      return cb(i === j, {});
    });
  });

  atest("basic iced set structs", function(cb) {
    var field, i, obj, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    field = "yo";
    i = 10;
    obj = {
      cat: {
        dog: 0
      }
    };
    (function(__iced_k) {
      __iced_deferrals = new iced.Deferrals(__iced_k, {
        parent: ___iced_passed_deferral,
        filename: "test/iced.coffee"
      });
      foo(i, __iced_deferrals.defer({
        assign_fn: (function(__slot_1, __slot_2) {
          return function() {
            return __slot_1[__slot_2] = arguments[0];
          };
        })(obj.cat, field),
        lineno: 32
      }));
      field = "bar";
      __iced_deferrals._fulfill();
    })(function() {
      return cb(obj.cat.yo === i, {});
    });
  });

  multi = function(cb, arr) {
    var ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    (function(__iced_k) {
      __iced_deferrals = new iced.Deferrals(__iced_k, {
        parent: ___iced_passed_deferral,
        filename: "test/iced.coffee",
        funcname: "multi"
      });
      delay(__iced_deferrals.defer({
        lineno: 36
      }));
      __iced_deferrals._fulfill();
    })(function() {
      return cb.apply(null, arr);
    });
  };

  atest("defer splats", function(cb) {
    var i, obj, ok, out, v, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    v = [1, 2, 3, 4];
    obj = {
      x: 0
    };
    (function(__iced_k) {
      __iced_deferrals = new iced.Deferrals(__iced_k, {
        parent: ___iced_passed_deferral,
        filename: "test/iced.coffee"
      });
      multi(__iced_deferrals.defer({
        assign_fn: (function(__slot_1) {
          return function() {
            __slot_1.x = arguments[0];
            return out = __slice.call(arguments, 1);
          };
        })(obj),
        lineno: 42
      }), v);
      __iced_deferrals._fulfill();
    })(function() {
      var _i, _ref;
      out.unshift(obj.x);
      ok = true;
      for (i = _i = 0, _ref = v.length - 1; 0 <= _ref ? _i <= _ref : _i >= _ref; i = 0 <= _ref ? ++_i : --_i) {
        if (v[i] !== out[i]) ok = false;
      }
      return cb(ok, {});
    });
  });

  atest("continue / break test", function(cb) {
    var i, tot, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    tot = 0;
    (function(__iced_k) {
      var _i, _results, _while;
      i = 0;
      _results = [];
      _while = function(__iced_k) {
        var _break, _continue, _next;
        _break = function() {
          return __iced_k(_results);
        };
        _continue = function() {
          return iced.trampoline(function() {
            ++i;
            return _while(__iced_k);
          });
        };
        _next = function(__iced_next_arg) {
          _results.push(__iced_next_arg);
          return _continue();
        };
        if (!(i <= 100)) {
          return _break();
        } else {
          (function(__iced_k) {
            __iced_deferrals = new iced.Deferrals(__iced_k, {
              parent: ___iced_passed_deferral,
              filename: "test/iced.coffee"
            });
            delay(__iced_deferrals.defer({
              lineno: 52
            }));
            __iced_deferrals._fulfill();
          })(function() {
            (function(__iced_k) {
              if (i === 3) {
                (function(__iced_k) {
                  _continue();
                })(__iced_k);
              } else {
                return __iced_k();
              }
            })(function() {
              tot += i;
              (function(__iced_k) {
                if (i === 10) {
                  (function(__iced_k) {
                    _break();
                  })(__iced_k);
                } else {
                  return __iced_k();
                }
              })(_next);
            });
          });
        }
      };
      _while(__iced_k);
    })(function() {
      return cb(tot === 52, {});
    });
  });

  atest("for k,v of obj testing", function(cb) {
    var k, obj, s, v, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    obj = {
      the: "quick",
      brown: "fox",
      jumped: "over"
    };
    s = "";
    (function(__iced_k) {
      var _i, _k, _keys, _ref, _results, _while;
      _ref = obj;
      _keys = (function() {
        var _results1;
        _results1 = [];
        for (_k in _ref) {
          _results1.push(_k);
        }
        return _results1;
      })();
      _i = 0;
      _results = [];
      _while = function(__iced_k) {
        var _break, _continue, _next;
        _break = function() {
          return __iced_k(_results);
        };
        _continue = function() {
          return iced.trampoline(function() {
            ++_i;
            return _while(__iced_k);
          });
        };
        _next = function(__iced_next_arg) {
          _results.push(__iced_next_arg);
          return _continue();
        };
        if (!(_i < _keys.length)) {
          return _break();
        } else {
          k = _keys[_i];
          v = _ref[k];
          (function(__iced_k) {
            __iced_deferrals = new iced.Deferrals(__iced_k, {
              parent: ___iced_passed_deferral,
              filename: "test/iced.coffee"
            });
            delay(__iced_deferrals.defer({
              lineno: 62
            }));
            __iced_deferrals._fulfill();
          })(function() {
            return _next(s += k + " " + v + " ");
          });
        }
      };
      _while(__iced_k);
    })(function() {
      return cb(s === "the quick brown fox jumped over ", {});
    });
  });

  atest("for k,v in arr testing", function(cb) {
    var i, obj, s, v, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    obj = ["the", "quick", "brown"];
    s = "";
    (function(__iced_k) {
      var _i, _len, _ref, _results, _while;
      _ref = obj;
      _len = _ref.length;
      i = 0;
      _results = [];
      _while = function(__iced_k) {
        var _break, _continue, _next;
        _break = function() {
          return __iced_k(_results);
        };
        _continue = function() {
          return iced.trampoline(function() {
            ++i;
            return _while(__iced_k);
          });
        };
        _next = function(__iced_next_arg) {
          _results.push(__iced_next_arg);
          return _continue();
        };
        if (!(i < _len)) {
          return _break();
        } else {
          v = _ref[i];
          (function(__iced_k) {
            __iced_deferrals = new iced.Deferrals(__iced_k, {
              parent: ___iced_passed_deferral,
              filename: "test/iced.coffee"
            });
            delay(__iced_deferrals.defer({
              lineno: 70
            }));
            __iced_deferrals._fulfill();
          })(function() {
            return _next(s += v + " " + i + " ");
          });
        }
      };
      _while(__iced_k);
    })(function() {
      return cb(s === "the 0 quick 1 brown 2 ", {});
    });
  });

  atest("switch-a-roos", function(cb) {
    var i, res, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    res = 0;
    (function(__iced_k) {
      var _i, _results, _while;
      i = 0;
      _results = [];
      _while = function(__iced_k) {
        var _break, _continue, _next;
        _break = function() {
          return __iced_k(_results);
        };
        _continue = function() {
          return iced.trampoline(function() {
            ++i;
            return _while(__iced_k);
          });
        };
        _next = function(__iced_next_arg) {
          _results.push(__iced_next_arg);
          return _continue();
        };
        if (!(i <= 4)) {
          return _break();
        } else {
          (function(__iced_k) {
            __iced_deferrals = new iced.Deferrals(__iced_k, {
              parent: ___iced_passed_deferral,
              filename: "test/iced.coffee"
            });
            delay(__iced_deferrals.defer({
              lineno: 77
            }));
            __iced_deferrals._fulfill();
          })(function() {
            (function(__iced_k) {
              switch (i) {
                case 0:
                  return __iced_k(res += 1);
                case 1:
                  (function(__iced_k) {
                    __iced_deferrals = new iced.Deferrals(__iced_k, {
                      parent: ___iced_passed_deferral,
                      filename: "test/iced.coffee"
                    });
                    delay(__iced_deferrals.defer({
                      lineno: 81
                    }));
                    __iced_deferrals._fulfill();
                  })(function() {
                    return __iced_k(res += 20);
                  });
                  break;
                case 2:
                  (function(__iced_k) {
                    __iced_deferrals = new iced.Deferrals(__iced_k, {
                      parent: ___iced_passed_deferral,
                      filename: "test/iced.coffee"
                    });
                    delay(__iced_deferrals.defer({
                      lineno: 84
                    }));
                    __iced_deferrals._fulfill();
                  })(function() {
                    (function(__iced_k) {
                      if (false) {
                        return __iced_k(res += 100000);
                      } else {
                        (function(__iced_k) {
                          __iced_deferrals = new iced.Deferrals(__iced_k, {
                            parent: ___iced_passed_deferral,
                            filename: "test/iced.coffee"
                          });
                          delay(__iced_deferrals.defer({
                            lineno: 88
                          }));
                          __iced_deferrals._fulfill();
                        })(function() {
                          return __iced_k(res += 300);
                        });
                      }
                    })(__iced_k);
                  });
                  break;
                default:
                  return __iced_k(res += i * 1000);
              }
            })(function() {
              return _next(i === 2 ? res += 10000 : void 0);
            });
          });
        }
      };
      _while(__iced_k);
    })(function() {
      return cb(res === 17321, {});
    });
  });

  atest("parallel awaits with classes", function(cb) {
    var MyClass, obj, v, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    MyClass = (function() {

      function MyClass() {
        this.val = 0;
      }

      MyClass.prototype.increment = function(wait, i, cb) {
        var ___iced_passed_deferral1, __iced_deferrals, __iced_k,
          _this = this;
        __iced_k = __iced_k_noop;
        ___iced_passed_deferral1 = iced.findDeferral(arguments);
        (function(__iced_k) {
          __iced_deferrals = new iced.Deferrals(__iced_k, {
            parent: ___iced_passed_deferral1,
            filename: "test/iced.coffee",
            funcname: "MyClass.increment"
          });
          setTimeout(__iced_deferrals.defer({
            lineno: 101
          }), wait);
          __iced_deferrals._fulfill();
        })(function() {
          _this.val += i;
          (function(__iced_k) {
            __iced_deferrals = new iced.Deferrals(__iced_k, {
              parent: ___iced_passed_deferral1,
              filename: "test/iced.coffee",
              funcname: "MyClass.increment"
            });
            setTimeout(__iced_deferrals.defer({
              lineno: 103
            }), wait);
            __iced_deferrals._fulfill();
          })(function() {
            _this.val += i;
            return cb();
          });
        });
      };

      MyClass.prototype.getVal = function() {
        return this.val;
      };

      return MyClass;

    })();
    obj = new MyClass();
    (function(__iced_k) {
      __iced_deferrals = new iced.Deferrals(__iced_k, {
        parent: ___iced_passed_deferral,
        filename: "test/iced.coffee"
      });
      obj.increment(10, 1, __iced_deferrals.defer({
        lineno: 110
      }));
      obj.increment(20, 2, __iced_deferrals.defer({
        lineno: 111
      }));
      obj.increment(30, 4, __iced_deferrals.defer({
        lineno: 112
      }));
      __iced_deferrals._fulfill();
    })(function() {
      v = obj.getVal();
      return cb(v === 14, {});
    });
  });

  atest("loop construct", function(cb) {
    var i, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    i = 0;
    (function(__iced_k) {
      var _results, _while;
      _results = [];
      _while = function(__iced_k) {
        var _break, _continue, _next;
        _break = function() {
          return __iced_k(_results);
        };
        _continue = function() {
          return iced.trampoline(function() {
            return _while(__iced_k);
          });
        };
        _next = function(__iced_next_arg) {
          _results.push(__iced_next_arg);
          return _continue();
        };
        if (!true) {
          return _break();
        } else {
          (function(__iced_k) {
            __iced_deferrals = new iced.Deferrals(__iced_k, {
              parent: ___iced_passed_deferral,
              filename: "test/iced.coffee"
            });
            delay(__iced_deferrals.defer({
              lineno: 119
            }));
            __iced_deferrals._fulfill();
          })(function() {
            i += 1;
            (function(__iced_k) {
              __iced_deferrals = new iced.Deferrals(__iced_k, {
                parent: ___iced_passed_deferral,
                filename: "test/iced.coffee"
              });
              delay(__iced_deferrals.defer({
                lineno: 121
              }));
              __iced_deferrals._fulfill();
            })(function() {
              (function(__iced_k) {
                if (i === 10) {
                  (function(__iced_k) {
                    _break();
                  })(__iced_k);
                } else {
                  return __iced_k();
                }
              })(function() {
                (function(__iced_k) {
                  __iced_deferrals = new iced.Deferrals(__iced_k, {
                    parent: ___iced_passed_deferral,
                    filename: "test/iced.coffee"
                  });
                  delay(__iced_deferrals.defer({
                    lineno: 123
                  }));
                  __iced_deferrals._fulfill();
                })(_next);
              });
            });
          });
        }
      };
      _while(__iced_k);
    })(function() {
      return cb(i === 10, {});
    });
  });

  atest("simple autocb operations", function(cb) {
    var b, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    b = false;
    foo = function(autocb) {
      var ___iced_passed_deferral1, __iced_deferrals, __iced_k,
        _this = this;
      __iced_k = autocb;
      ___iced_passed_deferral1 = iced.findDeferral(arguments);
      (function(__iced_k) {
        __iced_deferrals = new iced.Deferrals(__iced_k, {
          parent: ___iced_passed_deferral1,
          filename: "test/iced.coffee",
          funcname: "foo"
        });
        delay(__iced_deferrals.defer({
          lineno: 129
        }));
        __iced_deferrals._fulfill();
      })(function() {
        autocb(true);
        return;

      });
    };
    (function(__iced_k) {
      __iced_deferrals = new iced.Deferrals(__iced_k, {
        parent: ___iced_passed_deferral,
        filename: "test/iced.coffee"
      });
      foo(__iced_deferrals.defer({
        assign_fn: (function() {
          return function() {
            return b = arguments[0];
          };
        })(),
        lineno: 132
      }));
      __iced_deferrals._fulfill();
    })(function() {
      return cb(b, {});
    });
  });

  atest("AT variable works in an await (1)", function(cb) {
    var MyClass, o, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    MyClass = (function() {

      function MyClass() {
        this.flag = false;
      }

      MyClass.prototype.chill = function(autocb) {
        var ___iced_passed_deferral1, __iced_deferrals, __iced_k;
        __iced_k = autocb;
        ___iced_passed_deferral1 = iced.findDeferral(arguments);
        __iced_deferrals = new iced.Deferrals(__iced_k, {
          parent: ___iced_passed_deferral1,
          filename: "test/iced.coffee",
          funcname: "MyClass.chill"
        });
        delay(__iced_deferrals.defer({
          lineno: 139
        }));
        __iced_deferrals._fulfill();
      };

      MyClass.prototype.run = function(autocb) {
        var ___iced_passed_deferral1, __iced_deferrals, __iced_k,
          _this = this;
        __iced_k = autocb;
        ___iced_passed_deferral1 = iced.findDeferral(arguments);
        (function(__iced_k) {
          __iced_deferrals = new iced.Deferrals(__iced_k, {
            parent: ___iced_passed_deferral1,
            filename: "test/iced.coffee",
            funcname: "MyClass.run"
          });
          _this.chill(__iced_deferrals.defer({
            lineno: 141
          }));
          __iced_deferrals._fulfill();
        })(function() {
          autocb(_this.flag = true);
          return;

        });
      };

      MyClass.prototype.getFlag = function() {
        return this.flag;
      };

      return MyClass;

    })();
    o = new MyClass;
    (function(__iced_k) {
      __iced_deferrals = new iced.Deferrals(__iced_k, {
        parent: ___iced_passed_deferral,
        filename: "test/iced.coffee"
      });
      o.run(__iced_deferrals.defer({
        lineno: 145
      }));
      __iced_deferrals._fulfill();
    })(function() {
      return cb(o.getFlag(), {});
    });
  });

  atest("more advanced autocb test", function(cb) {
    var bar, oks, x, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    bar = function() {
      return "yoyo";
    };
    foo = function(val, autocb) {
      var ___iced_passed_deferral1, __iced_deferrals, __iced_k,
        _this = this;
      __iced_k = autocb;
      ___iced_passed_deferral1 = iced.findDeferral(arguments);
      (function(__iced_k) {
        __iced_deferrals = new iced.Deferrals(__iced_k, {
          parent: ___iced_passed_deferral1,
          filename: "test/iced.coffee",
          funcname: "foo"
        });
        delay(__iced_deferrals.defer({
          lineno: 151
        }));
        __iced_deferrals._fulfill();
      })(function() {
        if (val === 0) {
          autocb([1, 2, 3]);
          return;

        } else if (val === 1) {
          autocb({
            a: 10
          });
          return;

        } else if (val === 2) {
          autocb(bar());
          return;

        } else {
          autocb(33);
          return;

        }
      });
    };
    oks = 0;
    (function(__iced_k) {
      __iced_deferrals = new iced.Deferrals(__iced_k, {
        parent: ___iced_passed_deferral,
        filename: "test/iced.coffee"
      });
      foo(0, __iced_deferrals.defer({
        assign_fn: (function() {
          return function() {
            return x = arguments[0];
          };
        })(),
        lineno: 158
      }));
      __iced_deferrals._fulfill();
    })(function() {
      if (x[2] === 3) oks++;
      (function(__iced_k) {
        __iced_deferrals = new iced.Deferrals(__iced_k, {
          parent: ___iced_passed_deferral,
          filename: "test/iced.coffee"
        });
        foo(1, __iced_deferrals.defer({
          assign_fn: (function() {
            return function() {
              return x = arguments[0];
            };
          })(),
          lineno: 160
        }));
        __iced_deferrals._fulfill();
      })(function() {
        if (x.a === 10) oks++;
        (function(__iced_k) {
          __iced_deferrals = new iced.Deferrals(__iced_k, {
            parent: ___iced_passed_deferral,
            filename: "test/iced.coffee"
          });
          foo(2, __iced_deferrals.defer({
            assign_fn: (function() {
              return function() {
                return x = arguments[0];
              };
            })(),
            lineno: 162
          }));
          __iced_deferrals._fulfill();
        })(function() {
          if (x === "yoyo") oks++;
          (function(__iced_k) {
            __iced_deferrals = new iced.Deferrals(__iced_k, {
              parent: ___iced_passed_deferral,
              filename: "test/iced.coffee"
            });
            foo(100, __iced_deferrals.defer({
              assign_fn: (function() {
                return function() {
                  return x = arguments[0];
                };
              })(),
              lineno: 164
            }));
            __iced_deferrals._fulfill();
          })(function() {
            if (x === 33) oks++;
            return cb(oks === 4, {});
          });
        });
      });
    });
  });

  atest("test of autocb in a simple function", function(cb) {
    var ok, simple, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    simple = function(autocb) {
      var ___iced_passed_deferral1, __iced_deferrals, __iced_k;
      __iced_k = autocb;
      ___iced_passed_deferral1 = iced.findDeferral(arguments);
      __iced_deferrals = new iced.Deferrals(__iced_k, {
        parent: ___iced_passed_deferral1,
        filename: "test/iced.coffee",
        funcname: "simple"
      });
      delay(__iced_deferrals.defer({
        lineno: 169
      }));
      __iced_deferrals._fulfill();
    };
    ok = false;
    (function(__iced_k) {
      __iced_deferrals = new iced.Deferrals(__iced_k, {
        parent: ___iced_passed_deferral,
        filename: "test/iced.coffee"
      });
      simple(__iced_deferrals.defer({
        lineno: 171
      }));
      __iced_deferrals._fulfill();
    })(function() {
      ok = true;
      return cb(ok, {});
    });
  });

  atest("test nested serial/parallel", function(cb) {
    var i, ok, slots, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    slots = [];
    (function(__iced_k) {
      var _fn, _i;
      __iced_deferrals = new iced.Deferrals(__iced_k, {
        parent: ___iced_passed_deferral,
        filename: "test/iced.coffee"
      });
      _fn = function(j, autocb) {
        var ___iced_passed_deferral1, __iced_deferrals, __iced_k,
          _this = this;
        __iced_k = autocb;
        ___iced_passed_deferral1 = iced.findDeferral(arguments);
        (function(__iced_k) {
          __iced_deferrals = new iced.Deferrals(__iced_k, {
            parent: ___iced_passed_deferral1,
            filename: "test/iced.coffee",
            funcname: "_fn"
          });
          delay(__iced_deferrals.defer({
            lineno: 180
          }), 5 * Math.random());
          __iced_deferrals._fulfill();
        })(function() {
          (function(__iced_k) {
            __iced_deferrals = new iced.Deferrals(__iced_k, {
              parent: ___iced_passed_deferral1,
              filename: "test/iced.coffee",
              funcname: "_fn"
            });
            delay(__iced_deferrals.defer({
              lineno: 181
            }), 4 * Math.random());
            __iced_deferrals._fulfill();
          })(function() {
            autocb(slots[j] = true);
            return;

          });
        });
      };
      for (i = _i = 0; _i <= 10; i = ++_i) {
        _fn(i, __iced_deferrals.defer({
          lineno: 183
        }));
      }
      __iced_deferrals._fulfill();
    })(function() {
      var _i;
      ok = true;
      for (i = _i = 0; _i <= 10; i = ++_i) {
        if (!slots[i]) ok = false;
      }
      return cb(ok, {});
    });
  });

  atest("loops respect autocbs", function(cb) {
    var bar, ok, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    ok = false;
    bar = function(autocb) {
      var i, ___iced_passed_deferral1, __iced_deferrals, __iced_k, _i, _results, _while,
        _this = this;
      __iced_k = autocb;
      ___iced_passed_deferral1 = iced.findDeferral(arguments);
      i = 0;
      _results = [];
      _while = function(__iced_k) {
        var _break, _continue, _next;
        _break = function() {
          return __iced_k(_results);
        };
        _continue = function() {
          return iced.trampoline(function() {
            ++i;
            return _while(__iced_k);
          });
        };
        _next = function(__iced_next_arg) {
          _results.push(__iced_next_arg);
          return _continue();
        };
        if (!(i <= 10)) {
          return _break();
        } else {
          (function(__iced_k) {
            __iced_deferrals = new iced.Deferrals(__iced_k, {
              parent: ___iced_passed_deferral1,
              filename: "test/iced.coffee",
              funcname: "bar"
            });
            delay(__iced_deferrals.defer({
              lineno: 193
            }));
            __iced_deferrals._fulfill();
          })(function() {
            return _next(ok = true);
          });
        }
      };
      _while(__iced_k);
    };
    (function(__iced_k) {
      __iced_deferrals = new iced.Deferrals(__iced_k, {
        parent: ___iced_passed_deferral,
        filename: "test/iced.coffee"
      });
      bar(__iced_deferrals.defer({
        lineno: 195
      }));
      __iced_deferrals._fulfill();
    })(function() {
      return cb(ok, {});
    });
  });

  atest("test scoping", function(cb) {
    var MyClass, o, v, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    MyClass = (function() {

      function MyClass() {
        this.val = 0;
      }

      MyClass.prototype.run = function(autocb) {
        var Inner, i, ___iced_passed_deferral1, __iced_deferrals, __iced_k,
          _this = this;
        __iced_k = autocb;
        ___iced_passed_deferral1 = iced.findDeferral(arguments);
        this.val++;
        (function(__iced_k) {
          __iced_deferrals = new iced.Deferrals(__iced_k, {
            parent: ___iced_passed_deferral1,
            filename: "test/iced.coffee",
            funcname: "MyClass.run"
          });
          delay(__iced_deferrals.defer({
            lineno: 203
          }));
          __iced_deferrals._fulfill();
        })(function() {
          _this.val++;
          (function(__iced_k) {
            __iced_deferrals = new iced.Deferrals(__iced_k, {
              parent: ___iced_passed_deferral1,
              filename: "test/iced.coffee",
              funcname: "MyClass.run"
            });
            Inner = (function() {

              function Inner() {}

              Inner.prototype.chill = function(autocb) {
                var ___iced_passed_deferral2, __iced_deferrals, __iced_k,
                  _this = this;
                __iced_k = autocb;
                ___iced_passed_deferral2 = iced.findDeferral(arguments);
                (function(__iced_k) {
                  __iced_deferrals = new iced.Deferrals(__iced_k, {
                    parent: ___iced_passed_deferral2,
                    filename: "test/iced.coffee",
                    funcname: "Inner.chill"
                  });
                  delay(__iced_deferrals.defer({
                    lineno: 208
                  }));
                  __iced_deferrals._fulfill();
                })(function() {
                  autocb(_this.val = 0);
                  return;

                });
              };

              return Inner;

            })();
            i = new Inner;
            i.chill(__iced_deferrals.defer({
              lineno: 211
            }));
            __iced_deferrals._fulfill();
          })(function() {
            _this.val++;
            (function(__iced_k) {
              __iced_deferrals = new iced.Deferrals(__iced_k, {
                parent: ___iced_passed_deferral1,
                filename: "test/iced.coffee",
                funcname: "MyClass.run"
              });
              delay(__iced_deferrals.defer({
                lineno: 213
              }));
              __iced_deferrals._fulfill();
            })(function() {
              _this.val++;
              (function(__iced_k) {
                __iced_deferrals = new iced.Deferrals(__iced_k, {
                  parent: ___iced_passed_deferral1,
                  filename: "test/iced.coffee",
                  funcname: "MyClass.run"
                });
                (function(autocb) {
                  var Inner, i, ___iced_passed_deferral2, __iced_deferrals, __iced_k;
                  __iced_k = autocb;
                  ___iced_passed_deferral2 = iced.findDeferral(arguments);
                  Inner = (function() {

                    function Inner() {}

                    Inner.prototype.chill = function(autocb) {
                      var ___iced_passed_deferral3, __iced_deferrals, __iced_k,
                        _this = this;
                      __iced_k = autocb;
                      ___iced_passed_deferral3 = iced.findDeferral(arguments);
                      (function(__iced_k) {
                        __iced_deferrals = new iced.Deferrals(__iced_k, {
                          parent: ___iced_passed_deferral3,
                          filename: "test/iced.coffee",
                          funcname: "Inner.chill"
                        });
                        delay(__iced_deferrals.defer({
                          lineno: 219
                        }));
                        __iced_deferrals._fulfill();
                      })(function() {
                        autocb(_this.val = 0);
                        return;

                      });
                    };

                    return Inner;

                  })();
                  i = new Inner;
                  __iced_deferrals = new iced.Deferrals(__iced_k, {
                    parent: ___iced_passed_deferral2,
                    filename: "test/iced.coffee"
                  });
                  i.chill(__iced_deferrals.defer({
                    lineno: 222
                  }));
                  __iced_deferrals._fulfill();
                })(__iced_deferrals.defer({
                  lineno: 223
                }));
                __iced_deferrals._fulfill();
              })(function() {
                autocb(++_this.val);
                return;

              });
            });
          });
        });
      };

      MyClass.prototype.getVal = function() {
        return this.val;
      };

      return MyClass;

    })();
    o = new MyClass;
    (function(__iced_k) {
      __iced_deferrals = new iced.Deferrals(__iced_k, {
        parent: ___iced_passed_deferral,
        filename: "test/iced.coffee"
      });
      o.run(__iced_deferrals.defer({
        assign_fn: (function() {
          return function() {
            return v = arguments[0];
          };
        })(),
        lineno: 227
      }));
      __iced_deferrals._fulfill();
    })(function() {
      return cb(v === 5, {});
    });
  });

  atest("AT variable works in an await (2)", function(cb) {
    var MyClass, o, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    MyClass = (function() {

      function MyClass() {
        this.val = 0;
      }

      MyClass.prototype.inc = function() {
        return this.val++;
      };

      MyClass.prototype.chill = function(autocb) {
        var ___iced_passed_deferral1, __iced_deferrals, __iced_k;
        __iced_k = autocb;
        ___iced_passed_deferral1 = iced.findDeferral(arguments);
        __iced_deferrals = new iced.Deferrals(__iced_k, {
          parent: ___iced_passed_deferral1,
          filename: "test/iced.coffee",
          funcname: "MyClass.chill"
        });
        delay(__iced_deferrals.defer({
          lineno: 234
        }));
        __iced_deferrals._fulfill();
      };

      MyClass.prototype.run = function(autocb) {
        var i, ___iced_passed_deferral1, __iced_deferrals, __iced_k,
          _this = this;
        __iced_k = autocb;
        ___iced_passed_deferral1 = iced.findDeferral(arguments);
        (function(__iced_k) {
          __iced_deferrals = new iced.Deferrals(__iced_k, {
            parent: ___iced_passed_deferral1,
            filename: "test/iced.coffee",
            funcname: "MyClass.run"
          });
          _this.chill(__iced_deferrals.defer({
            lineno: 236
          }));
          __iced_deferrals._fulfill();
        })(function() {
          var _i, _results, _while;
          i = 0;
          _results = [];
          _while = function(__iced_k) {
            var _break, _continue, _next;
            _break = function() {
              return __iced_k(_results);
            };
            _continue = function() {
              return iced.trampoline(function() {
                ++i;
                return _while(__iced_k);
              });
            };
            _next = function(__iced_next_arg) {
              _results.push(__iced_next_arg);
              return _continue();
            };
            if (!(i <= 9)) {
              return _break();
            } else {
              (function(__iced_k) {
                __iced_deferrals = new iced.Deferrals(__iced_k, {
                  parent: ___iced_passed_deferral1,
                  filename: "test/iced.coffee",
                  funcname: "MyClass.run"
                });
                _this.chill(__iced_deferrals.defer({
                  lineno: 238
                }));
                __iced_deferrals._fulfill();
              })(function() {
                return _next(_this.inc());
              });
            }
          };
          _while(__iced_k);
        });
      };

      MyClass.prototype.getVal = function() {
        return this.val;
      };

      return MyClass;

    })();
    o = new MyClass;
    (function(__iced_k) {
      __iced_deferrals = new iced.Deferrals(__iced_k, {
        parent: ___iced_passed_deferral,
        filename: "test/iced.coffee"
      });
      o.run(__iced_deferrals.defer({
        lineno: 242
      }));
      __iced_deferrals._fulfill();
    })(function() {
      return cb(o.getVal() === 10, {});
    });
  });

  atest("another autocb gotcha", function(cb) {
    var bar, ok, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    bar = function(autocb) {
      var ___iced_passed_deferral1, __iced_deferrals, __iced_k,
        _this = this;
      __iced_k = autocb;
      ___iced_passed_deferral1 = iced.findDeferral(arguments);
      if (true) {
        (function(__iced_k) {
          __iced_deferrals = new iced.Deferrals(__iced_k, {
            parent: ___iced_passed_deferral1,
            filename: "test/iced.coffee",
            funcname: "bar"
          });
          delay(__iced_deferrals.defer({
            lineno: 247
          }));
          __iced_deferrals._fulfill();
        })(__iced_k);
      } else {
        return __iced_k();
      }
    };
    ok = false;
    (function(__iced_k) {
      __iced_deferrals = new iced.Deferrals(__iced_k, {
        parent: ___iced_passed_deferral,
        filename: "test/iced.coffee"
      });
      bar(__iced_deferrals.defer({
        lineno: 249
      }));
      __iced_deferrals._fulfill();
    })(function() {
      ok = true;
      return cb(ok, {});
    });
  });

  atest("fat arrow versus iced", function(cb) {
    var Foo, f, ok1, ok2, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    Foo = (function() {

      function Foo() {
        this.bindings = {};
      }

      Foo.prototype.addHandler = function(key, cb) {
        return this.bindings[key] = cb;
      };

      Foo.prototype.useHandler = function() {
        var args, key, _ref;
        key = arguments[0], args = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
        return (_ref = this.bindings)[key].apply(_ref, args);
      };

      Foo.prototype.delay = function(autocb) {
        var ___iced_passed_deferral1, __iced_deferrals, __iced_k;
        __iced_k = autocb;
        ___iced_passed_deferral1 = iced.findDeferral(arguments);
        __iced_deferrals = new iced.Deferrals(__iced_k, {
          parent: ___iced_passed_deferral1,
          filename: "test/iced.coffee",
          funcname: "Foo.delay"
        });
        delay(__iced_deferrals.defer({
          lineno: 265
        }));
        __iced_deferrals._fulfill();
      };

      Foo.prototype.addHandlers = function() {
        var _this = this;
        this.addHandler("sleep1", function(cb) {
          var ___iced_passed_deferral1, __iced_deferrals, __iced_k;
          __iced_k = __iced_k_noop;
          ___iced_passed_deferral1 = iced.findDeferral(arguments);
          (function(__iced_k) {
            __iced_deferrals = new iced.Deferrals(__iced_k, {
              parent: ___iced_passed_deferral1,
              filename: "test/iced.coffee"
            });
            delay(__iced_deferrals.defer({
              lineno: 269
            }));
            __iced_deferrals._fulfill();
          })(function() {
            (function(__iced_k) {
              __iced_deferrals = new iced.Deferrals(__iced_k, {
                parent: ___iced_passed_deferral1,
                filename: "test/iced.coffee"
              });
              _this.delay(__iced_deferrals.defer({
                lineno: 270
              }));
              __iced_deferrals._fulfill();
            })(function() {
              return cb(true);
            });
          });
        });
        return this.addHandler("sleep2", function(cb) {
          var ___iced_passed_deferral1, __iced_deferrals, __iced_k;
          __iced_k = __iced_k_noop;
          ___iced_passed_deferral1 = iced.findDeferral(arguments);
          (function(__iced_k) {
            __iced_deferrals = new iced.Deferrals(__iced_k, {
              parent: ___iced_passed_deferral1,
              filename: "test/iced.coffee"
            });
            _this.delay(__iced_deferrals.defer({
              lineno: 273
            }));
            __iced_deferrals._fulfill();
          })(function() {
            (function(__iced_k) {
              __iced_deferrals = new iced.Deferrals(__iced_k, {
                parent: ___iced_passed_deferral1,
                filename: "test/iced.coffee"
              });
              delay(__iced_deferrals.defer({
                lineno: 274
              }));
              __iced_deferrals._fulfill();
            })(function() {
              return cb(true);
            });
          });
        });
      };

      return Foo;

    })();
    ok1 = ok2 = false;
    f = new Foo();
    f.addHandlers();
    (function(__iced_k) {
      __iced_deferrals = new iced.Deferrals(__iced_k, {
        parent: ___iced_passed_deferral,
        filename: "test/iced.coffee"
      });
      f.useHandler("sleep1", __iced_deferrals.defer({
        assign_fn: (function() {
          return function() {
            return ok1 = arguments[0];
          };
        })(),
        lineno: 280
      }));
      __iced_deferrals._fulfill();
    })(function() {
      (function(__iced_k) {
        __iced_deferrals = new iced.Deferrals(__iced_k, {
          parent: ___iced_passed_deferral,
          filename: "test/iced.coffee"
        });
        f.useHandler("sleep2", __iced_deferrals.defer({
          assign_fn: (function() {
            return function() {
              return ok2 = arguments[0];
            };
          })(),
          lineno: 281
        }));
        __iced_deferrals._fulfill();
      })(function() {
        return cb(ok1 && ok2, {});
      });
    });
  });

  atest("nested loops", function(cb) {
    var i, j, val, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    val = 0;
    (function(__iced_k) {
      var _i, _results, _while;
      i = 0;
      _results = [];
      _while = function(__iced_k) {
        var _break, _continue, _next;
        _break = function() {
          return __iced_k(_results);
        };
        _continue = function() {
          return iced.trampoline(function() {
            ++i;
            return _while(__iced_k);
          });
        };
        _next = function(__iced_next_arg) {
          _results.push(__iced_next_arg);
          return _continue();
        };
        if (!(i <= 9)) {
          return _break();
        } else {
          (function(__iced_k) {
            __iced_deferrals = new iced.Deferrals(__iced_k, {
              parent: ___iced_passed_deferral,
              filename: "test/iced.coffee"
            });
            delay(__iced_deferrals.defer({
              lineno: 287
            }), 1);
            __iced_deferrals._fulfill();
          })(function() {
            (function(__iced_k) {
              var _j, _results1, _while;
              j = 0;
              _results1 = [];
              _while = function(__iced_k) {
                var _break, _continue, _next;
                _break = function() {
                  return __iced_k(_results1);
                };
                _continue = function() {
                  return iced.trampoline(function() {
                    ++j;
                    return _while(__iced_k);
                  });
                };
                _next = function(__iced_next_arg) {
                  _results1.push(__iced_next_arg);
                  return _continue();
                };
                if (!(j <= 9)) {
                  return _break();
                } else {
                  (function(__iced_k) {
                    __iced_deferrals = new iced.Deferrals(__iced_k, {
                      parent: ___iced_passed_deferral,
                      filename: "test/iced.coffee"
                    });
                    delay(__iced_deferrals.defer({
                      lineno: 289
                    }), 1);
                    __iced_deferrals._fulfill();
                  })(function() {
                    return _next(val++);
                  });
                }
              };
              _while(__iced_k);
            })(_next);
          });
        }
      };
      _while(__iced_k);
    })(function() {
      return cb(val === 100, {});
    });
  });

  atest("empty autocb", function(cb) {
    var bar, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    bar = function(autocb) {
      autocb();
      return;

    };
    (function(__iced_k) {
      __iced_deferrals = new iced.Deferrals(__iced_k, {
        parent: ___iced_passed_deferral,
        filename: "test/iced.coffee"
      });
      bar(__iced_deferrals.defer({
        lineno: 295
      }));
      __iced_deferrals._fulfill();
    })(function() {
      return cb(true, {});
    });
  });

  atest("more autocb (false)", function(cb) {
    var bar, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    bar = function(autocb) {
      if (false) {
        autocb(console.log("not reached"));
        return;

      }
      autocb();
      return;

    };
    (function(__iced_k) {
      __iced_deferrals = new iced.Deferrals(__iced_k, {
        parent: ___iced_passed_deferral,
        filename: "test/iced.coffee"
      });
      bar(__iced_deferrals.defer({
        lineno: 302
      }));
      __iced_deferrals._fulfill();
    })(function() {
      return cb(true, {});
    });
  });

  atest("more autocb (true)", function(cb) {
    var bar, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    bar = function(autocb) {
      if (true) {
        autocb(10);
        return;

      }
      autocb();
      return;

    };
    (function(__iced_k) {
      __iced_deferrals = new iced.Deferrals(__iced_k, {
        parent: ___iced_passed_deferral,
        filename: "test/iced.coffee"
      });
      bar(__iced_deferrals.defer({
        lineno: 309
      }));
      __iced_deferrals._fulfill();
    })(function() {
      return cb(true, {});
    });
  });

  atest("more autocb (true & false)", function(cb) {
    var bar, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    bar = function(autocb) {
      if (false) {
        autocb(10);
        return;

      } else {
        if (false) {
          autocb(11);
          return;

        }
        autocb();
        return;

      }
    };
    (function(__iced_k) {
      __iced_deferrals = new iced.Deferrals(__iced_k, {
        parent: ___iced_passed_deferral,
        filename: "test/iced.coffee"
      });
      bar(__iced_deferrals.defer({
        lineno: 319
      }));
      __iced_deferrals._fulfill();
    })(function() {
      return cb(true, {});
    });
  });

  atest("more autocb (while)", function(cb) {
    var bar, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    bar = function(autocb) {
      var _results;
      _results = [];
      while (false) {
        _results.push(10);
      }
      autocb(_results);
      return;
    };
    (function(__iced_k) {
      __iced_deferrals = new iced.Deferrals(__iced_k, {
        parent: ___iced_passed_deferral,
        filename: "test/iced.coffee"
      });
      bar(__iced_deferrals.defer({
        lineno: 326
      }));
      __iced_deferrals._fulfill();
    })(function() {
      return cb(true, {});
    });
  });

  atest("more autocb (comments)", function(cb) {
    var bar, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    bar = function(autocb) {
      /*
          blah blah blah
      */
      autocb();
      return;

    };
    (function(__iced_k) {
      __iced_deferrals = new iced.Deferrals(__iced_k, {
        parent: ___iced_passed_deferral,
        filename: "test/iced.coffee"
      });
      bar(__iced_deferrals.defer({
        lineno: 334
      }));
      __iced_deferrals._fulfill();
    })(function() {
      return cb(true, {});
    });
  });

  atest("until", function(cb) {
    var i, out, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    i = 10;
    out = 0;
    (function(__iced_k) {
      var _results, _while;
      _results = [];
      _while = function(__iced_k) {
        var _break, _continue, _next;
        _break = function() {
          return __iced_k(_results);
        };
        _continue = function() {
          return iced.trampoline(function() {
            return _while(__iced_k);
          });
        };
        _next = function(__iced_next_arg) {
          _results.push(__iced_next_arg);
          return _continue();
        };
        if (i === 0) {
          return _break();
        } else {
          (function(__iced_k) {
            __iced_deferrals = new iced.Deferrals(__iced_k, {
              parent: ___iced_passed_deferral,
              filename: "test/iced.coffee"
            });
            delay(__iced_deferrals.defer({
              lineno: 341
            }));
            __iced_deferrals._fulfill();
          })(function() {
            return _next(out += i--);
          });
        }
      };
      _while(__iced_k);
    })(function() {
      return cb(out === 55, {});
    });
  });

  atest('expressions -- simple assignment', function(cb) {
    var adder, ret, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    adder = function(x, cb) {
      var ___iced_passed_deferral1, __iced_deferrals, __iced_k,
        _this = this;
      __iced_k = __iced_k_noop;
      ___iced_passed_deferral1 = iced.findDeferral(arguments);
      (function(__iced_k) {
        __iced_deferrals = new iced.Deferrals(__iced_k, {
          parent: ___iced_passed_deferral1,
          filename: "test/iced.coffee",
          funcname: "adder"
        });
        delay(__iced_deferrals.defer({
          lineno: 347
        }));
        __iced_deferrals._fulfill();
      })(function() {
        return cb(x + 1);
      });
    };
    return (function(__iced_k) {
      __iced_deferrals = new iced.Deferrals(__iced_k, {
        parent: ___iced_passed_deferral,
        filename: "test/iced.coffee"
      });
      adder(5, __iced_deferrals.defer({
        assign_fn: (function() {
          return function() {
            return __iced_deferrals.ret = arguments[0];
          };
        })(),
        lineno: 350
      }));
      __iced_deferrals._fulfill();
    })(function(___iced_p__0) {
      ret = ___iced_p__0;
      return cb(ret === 6, {});
    });
  });

  atest('expressions -- simple, but recursive', function(cb) {
    var y, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    return (function(__iced_k) {
      if (true) {
        (function(__iced_k) {
          __iced_deferrals = new iced.Deferrals(__iced_k, {
            parent: ___iced_passed_deferral,
            filename: "test/iced.coffee"
          });
          delay(__iced_deferrals.defer({
            lineno: 354
          }));
          __iced_deferrals._fulfill();
        })(function() {
          return __iced_k(10);
        });
      } else {
        return __iced_k();
      }
    })(function(___iced_p__1) {
      y = ___iced_p__1;
      return cb(y === 10, {});
    });
  });

  atest('expressions -- simple, but recursive (2)', function(cb) {
    var adder, x, y, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    adder = function(x, cb) {
      var ___iced_passed_deferral1, __iced_deferrals, __iced_k,
        _this = this;
      __iced_k = __iced_k_noop;
      ___iced_passed_deferral1 = iced.findDeferral(arguments);
      (function(__iced_k) {
        __iced_deferrals = new iced.Deferrals(__iced_k, {
          parent: ___iced_passed_deferral1,
          filename: "test/iced.coffee",
          funcname: "adder"
        });
        delay(__iced_deferrals.defer({
          lineno: 360
        }));
        __iced_deferrals._fulfill();
      })(function() {
        return cb(x + 1);
      });
    };
    return (function(__iced_k) {
      if (true) {
        return (function(__iced_k) {
          __iced_deferrals = new iced.Deferrals(__iced_k, {
            parent: ___iced_passed_deferral,
            filename: "test/iced.coffee"
          });
          adder(4, __iced_deferrals.defer({
            assign_fn: (function() {
              return function() {
                return __iced_deferrals.ret = arguments[0];
              };
            })(),
            lineno: 364
          }));
          __iced_deferrals._fulfill();
        })(function(___iced_p__3) {
          x = ___iced_p__3;
          return __iced_k(++x);
        });
      } else {
        return __iced_k();
      }
    })(function(___iced_p__2) {
      y = ___iced_p__2;
      return cb(y === 6, {});
    });
  });

  atest('expressions -- pass value of tail calls', function(cb) {
    var adder, y, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    adder = function(x, cb) {
      var ___iced_passed_deferral1, __iced_deferrals, __iced_k,
        _this = this;
      __iced_k = __iced_k_noop;
      ___iced_passed_deferral1 = iced.findDeferral(arguments);
      (function(__iced_k) {
        __iced_deferrals = new iced.Deferrals(__iced_k, {
          parent: ___iced_passed_deferral1,
          filename: "test/iced.coffee",
          funcname: "adder"
        });
        delay(__iced_deferrals.defer({
          lineno: 369
        }));
        __iced_deferrals._fulfill();
      })(function() {
        return cb(x + 1);
      });
    };
    return (function(__iced_k) {
      if (true) {
        (function(__iced_k) {
          __iced_deferrals = new iced.Deferrals(__iced_k, {
            parent: ___iced_passed_deferral,
            filename: "test/iced.coffee"
          });
          adder(5, __iced_deferrals.defer({
            assign_fn: (function() {
              return function() {
                return __iced_deferrals.ret = arguments[0];
              };
            })(),
            lineno: 373
          }));
          __iced_deferrals._fulfill();
        })(__iced_k);
      } else {
        return __iced_k();
      }
    })(function(___iced_p__4) {
      y = ___iced_p__4;
      return cb(y === 6, {});
    });
  });

  atest('expressions -- addition (1)', function(cb) {
    var slowAdd, y, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    slowAdd = function(a, b, autocb) {
      var ___iced_passed_deferral1, __iced_deferrals, __iced_k,
        _this = this;
      __iced_k = autocb;
      ___iced_passed_deferral1 = iced.findDeferral(arguments);
      (function(__iced_k) {
        __iced_deferrals = new iced.Deferrals(__iced_k, {
          parent: ___iced_passed_deferral1,
          filename: "test/iced.coffee",
          funcname: "slowAdd"
        });
        delay(__iced_deferrals.defer({
          lineno: 377
        }));
        __iced_deferrals._fulfill();
      })(function() {
        autocb(a + b);
        return;

      });
    };
    return (function(__iced_k) {
      return (function(__iced_k) {
        __iced_deferrals = new iced.Deferrals(__iced_k, {
          parent: ___iced_passed_deferral,
          filename: "test/iced.coffee"
        });
        slowAdd(30, 40, __iced_deferrals.defer({
          assign_fn: (function() {
            return function() {
              return __iced_deferrals.ret = arguments[0];
            };
          })(),
          lineno: 379
        }));
        __iced_deferrals._fulfill();
      })(function(___iced_p__6) {
        return __iced_k(30 + ___iced_p__6);
      });
    })(function(___iced_p__5) {
      y = ___iced_p__5;
      return cb(y === 100, {});
    });
  });

  atest('expressions -- addition (2)', function(cb) {
    var slowAdd, y, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    slowAdd = function(a, b, autocb) {
      var ___iced_passed_deferral1, __iced_deferrals, __iced_k,
        _this = this;
      __iced_k = autocb;
      ___iced_passed_deferral1 = iced.findDeferral(arguments);
      (function(__iced_k) {
        __iced_deferrals = new iced.Deferrals(__iced_k, {
          parent: ___iced_passed_deferral1,
          filename: "test/iced.coffee",
          funcname: "slowAdd"
        });
        delay(__iced_deferrals.defer({
          lineno: 385
        }));
        __iced_deferrals._fulfill();
      })(function() {
        autocb(a + b);
        return;

      });
    };
    return (function(__iced_k) {
      return (function(__iced_k) {
        __iced_deferrals = new iced.Deferrals(__iced_k, {
          parent: ___iced_passed_deferral,
          filename: "test/iced.coffee"
        });
        slowAdd(10, 20, __iced_deferrals.defer({
          assign_fn: (function() {
            return function() {
              return __iced_deferrals.ret = arguments[0];
            };
          })(),
          lineno: 387
        }));
        __iced_deferrals._fulfill();
      })(function(___iced_p__9) {
        return (function(__iced_k) {
          __iced_deferrals = new iced.Deferrals(__iced_k, {
            parent: ___iced_passed_deferral,
            filename: "test/iced.coffee"
          });
          slowAdd(30, 40, __iced_deferrals.defer({
            assign_fn: (function() {
              return function() {
                return __iced_deferrals.ret = arguments[0];
              };
            })(),
            lineno: 387
          }));
          __iced_deferrals._fulfill();
        })(function(___iced_p__8) {
          return __iced_k(___iced_p__9 + ___iced_p__8);
        });
      });
    })(function(___iced_p__7) {
      y = ___iced_p__7;
      return cb(y === 100, {});
    });
  });

  atest('expressions - chaining', function(cb) {
    var Img, id, loadImage, x, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    id = "image data";
    Img = (function() {

      function Img() {}

      Img.prototype.render = function() {
        return id;
      };

      return Img;

    })();
    loadImage = function(n, cb) {
      var ___iced_passed_deferral1, __iced_deferrals, __iced_k,
        _this = this;
      __iced_k = __iced_k_noop;
      ___iced_passed_deferral1 = iced.findDeferral(arguments);
      (function(__iced_k) {
        __iced_deferrals = new iced.Deferrals(__iced_k, {
          parent: ___iced_passed_deferral1,
          filename: "test/iced.coffee",
          funcname: "loadImage"
        });
        delay(__iced_deferrals.defer({
          lineno: 395
        }));
        __iced_deferrals._fulfill();
      })(function() {
        return cb(new Img);
      });
    };
    return (function(__iced_k) {
      return (function(__iced_k) {
        return (function(__iced_k) {
          __iced_deferrals = new iced.Deferrals(__iced_k, {
            parent: ___iced_passed_deferral,
            filename: "test/iced.coffee"
          });
          loadImage("test.png", __iced_deferrals.defer({
            assign_fn: (function() {
              return function() {
                return __iced_deferrals.ret = arguments[0];
              };
            })(),
            lineno: 397
          }));
          __iced_deferrals._fulfill();
        })(function(___iced_p__12) {
          return __iced_k(___iced_p__12.render);
        });
      })(function(___iced_p__11) {
        return __iced_k(___iced_p__11());
      });
    })(function(___iced_p__10) {
      x = ___iced_p__10;
      return cb(x === id, {});
    });
  });

  atest('expressions - call args', function(cb) {
    var slowAdd, x, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    slowAdd = function(a, b, autocb) {
      var ___iced_passed_deferral1, __iced_deferrals, __iced_k,
        _this = this;
      __iced_k = autocb;
      ___iced_passed_deferral1 = iced.findDeferral(arguments);
      (function(__iced_k) {
        __iced_deferrals = new iced.Deferrals(__iced_k, {
          parent: ___iced_passed_deferral1,
          filename: "test/iced.coffee",
          funcname: "slowAdd"
        });
        delay(__iced_deferrals.defer({
          lineno: 402
        }));
        __iced_deferrals._fulfill();
      })(function() {
        autocb(a + b);
        return;

      });
    };
    return (function(__iced_k) {
      (function(__iced_k) {
        __iced_deferrals = new iced.Deferrals(__iced_k, {
          parent: ___iced_passed_deferral,
          filename: "test/iced.coffee"
        });
        slowAdd(3, 4, __iced_deferrals.defer({
          assign_fn: (function() {
            return function() {
              return __iced_deferrals.ret = arguments[0];
            };
          })(),
          lineno: 404
        }));
        __iced_deferrals._fulfill();
      })(function(___iced_p__14) {
        __iced_deferrals = new iced.Deferrals(__iced_k, {
          parent: ___iced_passed_deferral,
          filename: "test/iced.coffee"
        });
        slowAdd(3, ___iced_p__14, __iced_deferrals.defer({
          assign_fn: (function() {
            return function() {
              return __iced_deferrals.ret = arguments[0];
            };
          })(),
          lineno: 405
        }));
        __iced_deferrals._fulfill();
      });
    })(function(___iced_p__13) {
      x = ___iced_p__13;
      return cb(x === 10, {});
    });
  });

  atest('expressions - call args (2)', function(cb) {
    var slowAdd, x, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    slowAdd = function(a, b, autocb) {
      var ___iced_passed_deferral1, __iced_deferrals, __iced_k,
        _this = this;
      __iced_k = autocb;
      ___iced_passed_deferral1 = iced.findDeferral(arguments);
      (function(__iced_k) {
        __iced_deferrals = new iced.Deferrals(__iced_k, {
          parent: ___iced_passed_deferral1,
          filename: "test/iced.coffee",
          funcname: "slowAdd"
        });
        delay(__iced_deferrals.defer({
          lineno: 409
        }));
        __iced_deferrals._fulfill();
      })(function() {
        autocb(a + b);
        return;

      });
    };
    return (function(__iced_k) {
      (function(__iced_k) {
        __iced_deferrals = new iced.Deferrals(__iced_k, {
          parent: ___iced_passed_deferral,
          filename: "test/iced.coffee"
        });
        slowAdd(1, 2, __iced_deferrals.defer({
          assign_fn: (function() {
            return function() {
              return __iced_deferrals.ret = arguments[0];
            };
          })(),
          lineno: 411
        }));
        __iced_deferrals._fulfill();
      })(function(___iced_p__17) {
        return (function(__iced_k) {
          __iced_deferrals = new iced.Deferrals(__iced_k, {
            parent: ___iced_passed_deferral,
            filename: "test/iced.coffee"
          });
          slowAdd(3, 4, __iced_deferrals.defer({
            assign_fn: (function() {
              return function() {
                return __iced_deferrals.ret = arguments[0];
              };
            })(),
            lineno: 411
          }));
          __iced_deferrals._fulfill();
        })(function(___iced_p__16) {
          __iced_deferrals = new iced.Deferrals(__iced_k, {
            parent: ___iced_passed_deferral,
            filename: "test/iced.coffee"
          });
          slowAdd(___iced_p__17, ___iced_p__16, __iced_deferrals.defer({
            assign_fn: (function() {
              return function() {
                return __iced_deferrals.ret = arguments[0];
              };
            })(),
            lineno: 412
          }));
          __iced_deferrals._fulfill();
        });
      });
    })(function(___iced_p__15) {
      x = ___iced_p__15;
      return cb(x === 10, {});
    });
  });

  atest('arrays and objects', function(cb) {
    var arr, id, loadImage, obj, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    id = "image data";
    loadImage = function(n, cb) {
      var ___iced_passed_deferral1, __iced_deferrals, __iced_k,
        _this = this;
      __iced_k = __iced_k_noop;
      ___iced_passed_deferral1 = iced.findDeferral(arguments);
      (function(__iced_k) {
        __iced_deferrals = new iced.Deferrals(__iced_k, {
          parent: ___iced_passed_deferral1,
          filename: "test/iced.coffee",
          funcname: "loadImage"
        });
        delay(__iced_deferrals.defer({
          lineno: 417
        }));
        __iced_deferrals._fulfill();
      })(function() {
        return cb(id);
      });
    };
    return (function(__iced_k) {
      return (function(__iced_k) {
        __iced_deferrals = new iced.Deferrals(__iced_k, {
          parent: ___iced_passed_deferral,
          filename: "test/iced.coffee"
        });
        loadImage("file.jpg", __iced_deferrals.defer({
          assign_fn: (function() {
            return function() {
              return __iced_deferrals.ret = arguments[0];
            };
          })(),
          lineno: 420
        }));
        __iced_deferrals._fulfill();
      })(function(___iced_p__21) {
        return __iced_k([___iced_p__21, "another value"]);
      });
    })(function(___iced_p__18) {
      arr = ___iced_p__18;
      return (function(__iced_k) {
        return (function(__iced_k) {
          __iced_deferrals = new iced.Deferrals(__iced_k, {
            parent: ___iced_passed_deferral,
            filename: "test/iced.coffee"
          });
          loadImage("file.jpg", __iced_deferrals.defer({
            assign_fn: (function() {
              return function() {
                return __iced_deferrals.ret = arguments[0];
              };
            })(),
            lineno: 423
          }));
          __iced_deferrals._fulfill();
        })(function(___iced_p__20) {
          return __iced_k({
            i: ___iced_p__20,
            v: "another value"
          });
        });
      })(function(___iced_p__19) {
        obj = ___iced_p__19;
        return cb(arr[0] === id && obj.i === id, {});
      });
    });
  });

  atest('arrays 2', function(cb) {
    var arr, parrot, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    parrot = function(n, cb) {
      var ___iced_passed_deferral1, __iced_deferrals, __iced_k,
        _this = this;
      __iced_k = __iced_k_noop;
      ___iced_passed_deferral1 = iced.findDeferral(arguments);
      (function(__iced_k) {
        __iced_deferrals = new iced.Deferrals(__iced_k, {
          parent: ___iced_passed_deferral1,
          filename: "test/iced.coffee",
          funcname: "parrot"
        });
        delay(__iced_deferrals.defer({
          lineno: 429
        }));
        __iced_deferrals._fulfill();
      })(function() {
        return cb(n);
      });
    };
    return (function(__iced_k) {
      return (function(__iced_k) {
        __iced_deferrals = new iced.Deferrals(__iced_k, {
          parent: ___iced_passed_deferral,
          filename: "test/iced.coffee"
        });
        parrot(1, __iced_deferrals.defer({
          assign_fn: (function() {
            return function() {
              return __iced_deferrals.ret = arguments[0];
            };
          })(),
          lineno: 432
        }));
        __iced_deferrals._fulfill();
      })(function(___iced_p__25) {
        return (function(__iced_k) {
          return (function(__iced_k) {
            __iced_deferrals = new iced.Deferrals(__iced_k, {
              parent: ___iced_passed_deferral,
              filename: "test/iced.coffee"
            });
            parrot(2, __iced_deferrals.defer({
              assign_fn: (function() {
                return function() {
                  return __iced_deferrals.ret = arguments[0];
                };
              })(),
              lineno: 433
            }));
            __iced_deferrals._fulfill();
          })(function(___iced_p__27) {
            return (function(__iced_k) {
              __iced_deferrals = new iced.Deferrals(__iced_k, {
                parent: ___iced_passed_deferral,
                filename: "test/iced.coffee"
              });
              parrot(3, __iced_deferrals.defer({
                assign_fn: (function() {
                  return function() {
                    return __iced_deferrals.ret = arguments[0];
                  };
                })(),
                lineno: 434
              }));
              __iced_deferrals._fulfill();
            })(function(___iced_p__26) {
              return __iced_k([___iced_p__27, ___iced_p__26]);
            });
          });
        })(function(___iced_p__24) {
          return (function(__iced_k) {
            __iced_deferrals = new iced.Deferrals(__iced_k, {
              parent: ___iced_passed_deferral,
              filename: "test/iced.coffee"
            });
            parrot(4, __iced_deferrals.defer({
              assign_fn: (function() {
                return function() {
                  return __iced_deferrals.ret = arguments[0];
                };
              })(),
              lineno: 435
            }));
            __iced_deferrals._fulfill();
          })(function(___iced_p__23) {
            return __iced_k([___iced_p__25, ___iced_p__24, ___iced_p__23]);
          });
        });
      });
    })(function(___iced_p__22) {
      arr = ___iced_p__22;
      return cb(arr[0] + arr[1][0] + arr[1][1] + arr[2] === 10, {});
    });
  });

  atest('nesting', function(cb) {
    var id, loadImage, render, y, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    id = "image data";
    loadImage = function(n, cb) {
      var ___iced_passed_deferral1, __iced_deferrals, __iced_k,
        _this = this;
      __iced_k = __iced_k_noop;
      ___iced_passed_deferral1 = iced.findDeferral(arguments);
      (function(__iced_k) {
        __iced_deferrals = new iced.Deferrals(__iced_k, {
          parent: ___iced_passed_deferral1,
          filename: "test/iced.coffee",
          funcname: "loadImage"
        });
        delay(__iced_deferrals.defer({
          lineno: 441
        }));
        __iced_deferrals._fulfill();
      })(function() {
        return cb(id);
      });
    };
    render = function(x) {
      return x + x;
    };
    return (function(__iced_k) {
      return (function(__iced_k) {
        __iced_deferrals = new iced.Deferrals(__iced_k, {
          parent: ___iced_passed_deferral,
          filename: "test/iced.coffee"
        });
        loadImage("test.png", __iced_deferrals.defer({
          assign_fn: (function() {
            return function() {
              return __iced_deferrals.ret = arguments[0];
            };
          })(),
          lineno: 444
        }));
        __iced_deferrals._fulfill();
      })(function(___iced_p__29) {
        return __iced_k(render(___iced_p__29));
      });
    })(function(___iced_p__28) {
      y = ___iced_p__28;
      return cb(y === (id + id), {});
    });
  });

  atest('expressions + loops', function(cb) {
    var i, ok, parrot, v, x, y, z, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    parrot = function(n, cb) {
      var ___iced_passed_deferral1, __iced_deferrals, __iced_k,
        _this = this;
      __iced_k = __iced_k_noop;
      ___iced_passed_deferral1 = iced.findDeferral(arguments);
      (function(__iced_k) {
        __iced_deferrals = new iced.Deferrals(__iced_k, {
          parent: ___iced_passed_deferral1,
          filename: "test/iced.coffee",
          funcname: "parrot"
        });
        delay(__iced_deferrals.defer({
          lineno: 449
        }));
        __iced_deferrals._fulfill();
      })(function() {
        return cb(n);
      });
    };
    return (function(__iced_k) {
      var _i, _results, _while;
      i = 0;
      _results = [];
      _while = function(__iced_k) {
        var _break, _continue, _next;
        _break = function() {
          return __iced_k(_results);
        };
        _continue = function() {
          return iced.trampoline(function() {
            ++i;
            return _while(__iced_k);
          });
        };
        _next = function(__iced_next_arg) {
          _results.push(__iced_next_arg);
          return _continue();
        };
        if (!(i <= 9)) {
          return _break();
        } else {
          (function(__iced_k) {
            __iced_deferrals = new iced.Deferrals(__iced_k, {
              parent: ___iced_passed_deferral,
              filename: "test/iced.coffee"
            });
            parrot(i, __iced_deferrals.defer({
              assign_fn: (function() {
                return function() {
                  return __iced_deferrals.ret = arguments[0];
                };
              })(),
              lineno: 453
            }));
            __iced_deferrals._fulfill();
          })(_next);
        }
      };
      _while(__iced_k);
    })(function(___iced_p__30) {
      x = ___iced_p__30;
      return (function(__iced_k) {
        var _results, _while;
        _results = [];
        _while = function(__iced_k) {
          var _break, _continue, _next;
          _break = function() {
            return __iced_k(_results);
          };
          _continue = function() {
            return iced.trampoline(function() {
              return _while(__iced_k);
            });
          };
          _next = function(__iced_next_arg) {
            _results.push(__iced_next_arg);
            return _continue();
          };
          if (!i--) {
            return _break();
          } else {
            (function(__iced_k) {
              __iced_deferrals = new iced.Deferrals(__iced_k, {
                parent: ___iced_passed_deferral,
                filename: "test/iced.coffee"
              });
              parrot(i, __iced_deferrals.defer({
                assign_fn: (function() {
                  return function() {
                    return __iced_deferrals.ret = arguments[0];
                  };
                })(),
                lineno: 455
              }));
              __iced_deferrals._fulfill();
            })(_next);
          }
        };
        _while(__iced_k);
      })(function(___iced_p__31) {
        var _i, _len;
        y = ___iced_p__31;
        z = (function() {
          var _i, _len, _results;
          _results = [];
          for (i = _i = 0, _len = x.length; _i < _len; i = ++_i) {
            v = x[i];
            _results.push(v + y[i]);
          }
          return _results;
        })();
        ok = true;
        for (_i = 0, _len = z.length; _i < _len; _i++) {
          v = z[_i];
          if (v !== 9) ok = false;
        }
        return cb(ok, {});
      });
    });
  });

  atest('expressions + loops', function(cb) {
    var eat, food, lunch, ok, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    eat = function(item, cb) {
      var ___iced_passed_deferral1, __iced_deferrals, __iced_k,
        _this = this;
      __iced_k = __iced_k_noop;
      ___iced_passed_deferral1 = iced.findDeferral(arguments);
      (function(__iced_k) {
        __iced_deferrals = new iced.Deferrals(__iced_k, {
          parent: ___iced_passed_deferral1,
          filename: "test/iced.coffee",
          funcname: "eat"
        });
        delay(__iced_deferrals.defer({
          lineno: 463
        }));
        __iced_deferrals._fulfill();
      })(function() {
        return cb(item.length);
      });
    };
    return (function(__iced_k) {
      var _i, _len, _ref, _results, _while;
      _ref = ['toast', 'wine', 'pea'];
      _len = _ref.length;
      _i = 0;
      _results = [];
      _while = function(__iced_k) {
        var _break, _continue, _next;
        _break = function() {
          return __iced_k(_results);
        };
        _continue = function() {
          return iced.trampoline(function() {
            ++_i;
            return _while(__iced_k);
          });
        };
        _next = function(__iced_next_arg) {
          _results.push(__iced_next_arg);
          return _continue();
        };
        if (!(_i < _len)) {
          return _break();
        } else {
          food = _ref[_i];
          return (function(__iced_k) {
            __iced_deferrals = new iced.Deferrals(__iced_k, {
              parent: ___iced_passed_deferral,
              filename: "test/iced.coffee"
            });
            eat(food, __iced_deferrals.defer({
              assign_fn: (function() {
                return function() {
                  return __iced_deferrals.ret = arguments[0];
                };
              })(),
              lineno: 465
            }));
            __iced_deferrals._fulfill();
          })(_next);
        }
      };
      _while(__iced_k);
    })(function(___iced_p__32) {
      lunch = ___iced_p__32;
      ok = lunch[0] === 5 && lunch[1] === 4 && lunch[2] === 3;
      return cb(ok, {});
    });
  });

  atest('expressions + ops + if', function(cb) {
    var parrot, y, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    parrot = function(n, cb) {
      var ___iced_passed_deferral1, __iced_deferrals, __iced_k,
        _this = this;
      __iced_k = __iced_k_noop;
      ___iced_passed_deferral1 = iced.findDeferral(arguments);
      (function(__iced_k) {
        __iced_deferrals = new iced.Deferrals(__iced_k, {
          parent: ___iced_passed_deferral1,
          filename: "test/iced.coffee",
          funcname: "parrot"
        });
        delay(__iced_deferrals.defer({
          lineno: 471
        }));
        __iced_deferrals._fulfill();
      })(function() {
        return cb(n);
      });
    };
    return (function(__iced_k) {
      if (true) {
        return (function(__iced_k) {
          return (function(__iced_k) {
            __iced_deferrals = new iced.Deferrals(__iced_k, {
              parent: ___iced_passed_deferral,
              filename: "test/iced.coffee"
            });
            parrot(10, __iced_deferrals.defer({
              assign_fn: (function() {
                return function() {
                  return __iced_deferrals.ret = arguments[0];
                };
              })(),
              lineno: 474
            }));
            __iced_deferrals._fulfill();
          })(function(___iced_p__36) {
            return __iced_k(___iced_p__36 + 1);
          });
        })(__iced_k);
      } else {
        return __iced_k();
      }
    })(function(___iced_p__34) {
      y = ___iced_p__34;
      return cb(y === 11, {});
    });
  });

  atest('expressions + ops + if (2)', function(cb) {
    var parrot, y, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    parrot = function(n, cb) {
      var ___iced_passed_deferral1, __iced_deferrals, __iced_k,
        _this = this;
      __iced_k = __iced_k_noop;
      ___iced_passed_deferral1 = iced.findDeferral(arguments);
      (function(__iced_k) {
        __iced_deferrals = new iced.Deferrals(__iced_k, {
          parent: ___iced_passed_deferral1,
          filename: "test/iced.coffee",
          funcname: "parrot"
        });
        delay(__iced_deferrals.defer({
          lineno: 479
        }));
        __iced_deferrals._fulfill();
      })(function() {
        return cb(n);
      });
    };
    return (function(__iced_k) {
      if (true) {
        return (function(__iced_k) {
          return (function(__iced_k) {
            return (function(__iced_k) {
              __iced_deferrals = new iced.Deferrals(__iced_k, {
                parent: ___iced_passed_deferral,
                filename: "test/iced.coffee"
              });
              parrot(10, __iced_deferrals.defer({
                assign_fn: (function() {
                  return function() {
                    return __iced_deferrals.ret = arguments[0];
                  };
                })(),
                lineno: 482
              }));
              __iced_deferrals._fulfill();
            })(function(___iced_p__41) {
              return __iced_k(___iced_p__41 + 1);
            });
          })(function(___iced_p__40) {
            return (function(__iced_k) {
              __iced_deferrals = new iced.Deferrals(__iced_k, {
                parent: ___iced_passed_deferral,
                filename: "test/iced.coffee"
              });
              parrot(12, __iced_deferrals.defer({
                assign_fn: (function() {
                  return function() {
                    return __iced_deferrals.ret = arguments[0];
                  };
                })(),
                lineno: 482
              }));
              __iced_deferrals._fulfill();
            })(function(___iced_p__39) {
              return __iced_k(___iced_p__40 + ___iced_p__39);
            });
          });
        })(__iced_k);
      } else {
        return __iced_k();
      }
    })(function(___iced_p__37) {
      y = ___iced_p__37;
      return cb(y === 23, {});
    });
  });

  atest('expressions + ops + if (3)', function(cb) {
    var parrot, y, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    parrot = function(n, cb) {
      var ___iced_passed_deferral1, __iced_deferrals, __iced_k,
        _this = this;
      __iced_k = __iced_k_noop;
      ___iced_passed_deferral1 = iced.findDeferral(arguments);
      (function(__iced_k) {
        __iced_deferrals = new iced.Deferrals(__iced_k, {
          parent: ___iced_passed_deferral1,
          filename: "test/iced.coffee",
          funcname: "parrot"
        });
        delay(__iced_deferrals.defer({
          lineno: 487
        }));
        __iced_deferrals._fulfill();
      })(function() {
        return cb(n);
      });
    };
    return (function(__iced_k) {
      if (true) {
        return (function(__iced_k) {
          __iced_deferrals = new iced.Deferrals(__iced_k, {
            parent: ___iced_passed_deferral,
            filename: "test/iced.coffee"
          });
          parrot(10, __iced_deferrals.defer({
            assign_fn: (function() {
              return function() {
                return __iced_deferrals.ret = arguments[0];
              };
            })(),
            lineno: 490
          }));
          __iced_deferrals._fulfill();
        })(function(___iced_p__43) {
          ___iced_p__43 + 1;
          return __iced_k(3);
        });
      } else {
        return __iced_k();
      }
    })(function(___iced_p__42) {
      y = ___iced_p__42;
      return cb(y === 3, {});
    });
  });

  atest('super with no args', function(cb) {
    var A, P, a, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    P = (function() {

      function P() {
        this.x = 10;
      }

      return P;

    })();
    A = (function(_super) {

      __extends(A, _super);

      function A() {
        A.__super__.constructor.apply(this, arguments);
      }

      A.prototype.foo = function(cb) {
        var ___iced_passed_deferral1, __iced_deferrals, __iced_k,
          _this = this;
        __iced_k = __iced_k_noop;
        ___iced_passed_deferral1 = iced.findDeferral(arguments);
        (function(__iced_k) {
          __iced_deferrals = new iced.Deferrals(__iced_k, {
            parent: ___iced_passed_deferral1,
            filename: "test/iced.coffee",
            funcname: "A.foo"
          });
          delay(__iced_deferrals.defer({
            lineno: 502
          }));
          __iced_deferrals._fulfill();
        })(function() {
          return cb();
        });
      };

      return A;

    })(P);
    a = new A;
    (function(__iced_k) {
      __iced_deferrals = new iced.Deferrals(__iced_k, {
        parent: ___iced_passed_deferral,
        filename: "test/iced.coffee"
      });
      a.foo(__iced_deferrals.defer({
        lineno: 505
      }));
      __iced_deferrals._fulfill();
    })(function() {
      return cb(a.x === 10, {});
    });
  });

  atest('nested for .. of .. loops', function(cb) {
    var first, info, k, tot, v, x, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    x = {
      christian: {
        age: 36,
        last: "rudder"
      },
      max: {
        age: 34,
        last: "krohn"
      }
    };
    tot = 0;
    (function(__iced_k) {
      var _i, _k, _keys, _ref, _results, _while;
      _ref = x;
      _keys = (function() {
        var _results1;
        _results1 = [];
        for (_k in _ref) {
          _results1.push(_k);
        }
        return _results1;
      })();
      _i = 0;
      _results = [];
      _while = function(__iced_k) {
        var _break, _continue, _next;
        _break = function() {
          return __iced_k(_results);
        };
        _continue = function() {
          return iced.trampoline(function() {
            ++_i;
            return _while(__iced_k);
          });
        };
        _next = function(__iced_next_arg) {
          _results.push(__iced_next_arg);
          return _continue();
        };
        if (!(_i < _keys.length)) {
          return _break();
        } else {
          first = _keys[_i];
          info = _ref[first];
          tot += info.age;
          (function(__iced_k) {
            var _j, _keys1, _l, _ref1, _results1, _while;
            _ref1 = info;
            _keys1 = (function() {
              var _results2;
              _results2 = [];
              for (_l in _ref1) {
                _results2.push(_l);
              }
              return _results2;
            })();
            _j = 0;
            _results1 = [];
            _while = function(__iced_k) {
              var _break, _continue, _next;
              _break = function() {
                return __iced_k(_results1);
              };
              _continue = function() {
                return iced.trampoline(function() {
                  ++_j;
                  return _while(__iced_k);
                });
              };
              _next = function(__iced_next_arg) {
                _results1.push(__iced_next_arg);
                return _continue();
              };
              if (!(_j < _keys1.length)) {
                return _break();
              } else {
                k = _keys1[_j];
                v = _ref1[k];
                (function(__iced_k) {
                  __iced_deferrals = new iced.Deferrals(__iced_k, {
                    parent: ___iced_passed_deferral,
                    filename: "test/iced.coffee"
                  });
                  delay(__iced_deferrals.defer({
                    lineno: 521
                  }));
                  __iced_deferrals._fulfill();
                })(function() {
                  return _next(tot++);
                });
              }
            };
            _while(__iced_k);
          })(_next);
        }
      };
      _while(__iced_k);
    })(function() {
      return cb(tot === 74, {});
    });
  });

  atest('for + return + autocb', function(cb) {
    var bar, v, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    bar = function(autocb) {
      var i, ___iced_passed_deferral1, __iced_deferrals, __iced_k,
        _this = this;
      __iced_k = autocb;
      ___iced_passed_deferral1 = iced.findDeferral(arguments);
      (function(__iced_k) {
        __iced_deferrals = new iced.Deferrals(__iced_k, {
          parent: ___iced_passed_deferral1,
          filename: "test/iced.coffee",
          funcname: "bar"
        });
        delay(__iced_deferrals.defer({
          lineno: 527
        }));
        __iced_deferrals._fulfill();
      })(function() {
        var _i, _results;
        _results = [];
        for (i = _i = 0; _i <= 10; i = ++_i) {
          _results.push(i);
        }
        autocb(_results); return;
      });
    };
    (function(__iced_k) {
      __iced_deferrals = new iced.Deferrals(__iced_k, {
        parent: ___iced_passed_deferral,
        filename: "test/iced.coffee"
      });
      bar(__iced_deferrals.defer({
        assign_fn: (function() {
          return function() {
            return v = arguments[0];
          };
        })(),
        lineno: 530
      }));
      __iced_deferrals._fulfill();
    })(function() {
      return cb(v[3] === 3, {});
    });
  });

  atest('for + return + autocb (part 2)', function(cb) {
    var bar, v, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    bar = function(autocb) {
      var i, x, ___iced_passed_deferral1, __iced_deferrals, __iced_k,
        _this = this;
      __iced_k = autocb;
      ___iced_passed_deferral1 = iced.findDeferral(arguments);
      (function(__iced_k) {
        __iced_deferrals = new iced.Deferrals(__iced_k, {
          parent: ___iced_passed_deferral1,
          filename: "test/iced.coffee",
          funcname: "bar"
        });
        delay(__iced_deferrals.defer({
          lineno: 534
        }));
        __iced_deferrals._fulfill();
      })(function() {
        x = (function() {
          var _i, _results;
          _results = [];
          for (i = _i = 0; _i <= 10; i = ++_i) {
            _results.push(i);
          }
          return _results;
        })();
        autocb([10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20]);
        return;

      });
    };
    (function(__iced_k) {
      __iced_deferrals = new iced.Deferrals(__iced_k, {
        parent: ___iced_passed_deferral,
        filename: "test/iced.coffee"
      });
      bar(__iced_deferrals.defer({
        assign_fn: (function() {
          return function() {
            return v = arguments[0];
          };
        })(),
        lineno: 538
      }));
      __iced_deferrals._fulfill();
    })(function() {
      return cb(v[3] === 13, {});
    });
  });

  atest("for + guards", function(cb) {
    var i, v, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    return (function(__iced_k) {
      var _i, _results, _while;
      i = 0;
      _results = [];
      _while = function(__iced_k) {
        var _break, _continue, _next;
        _break = function() {
          return __iced_k(_results);
        };
        _continue = function() {
          return iced.trampoline(function() {
            ++i;
            return _while(__iced_k);
          });
        };
        _next = function(__iced_next_arg) {
          _results.push(__iced_next_arg);
          return _continue();
        };
        if (!(i <= 10)) {
          return _break();
        } else {
          if (i % 2 === 0) {
            (function(__iced_k) {
              __iced_deferrals = new iced.Deferrals(__iced_k, {
                parent: ___iced_passed_deferral,
                filename: "test/iced.coffee"
              });
              delay(__iced_deferrals.defer({
                lineno: 542
              }));
              __iced_deferrals._fulfill();
            })(function() {
              return _next(i);
            });
          } else {
            return _continue();
          }
        }
      };
      _while(__iced_k);
    })(function(___iced_p__44) {
      v = ___iced_p__44;
      return cb(v[3] === 6, {});
    });
  });

  atest("while + guards", function(cb) {
    var i, v, x, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    i = 0;
    return (function(__iced_k) {
      var _results, _while;
      _results = [];
      _while = function(__iced_k) {
        var _break, _continue, _next;
        _break = function() {
          return __iced_k(_results);
        };
        _continue = function() {
          return iced.trampoline(function() {
            return _while(__iced_k);
          });
        };
        _next = function(__iced_next_arg) {
          _results.push(__iced_next_arg);
          return _continue();
        };
        if (!((x = i++) < 10)) {
          return _break();
        } else {
          if (x % 2 === 0) {
            (function(__iced_k) {
              __iced_deferrals = new iced.Deferrals(__iced_k, {
                parent: ___iced_passed_deferral,
                filename: "test/iced.coffee"
              });
              delay(__iced_deferrals.defer({
                lineno: 549
              }));
              __iced_deferrals._fulfill();
            })(function() {
              return _next(x);
            });
          } else {
            return _continue();
          }
        }
      };
      _while(__iced_k);
    })(function(___iced_p__45) {
      v = ___iced_p__45;
      return cb(v[3] === 6, {});
    });
  });

  atest("nested loops + inner break", function(cb) {
    var i, j, res, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    i = 0;
    (function(__iced_k) {
      var _results, _while;
      _results = [];
      _while = function(__iced_k) {
        var _break, _continue, _next;
        _break = function() {
          return __iced_k(_results);
        };
        _continue = function() {
          return iced.trampoline(function() {
            return _while(__iced_k);
          });
        };
        _next = function(__iced_next_arg) {
          _results.push(__iced_next_arg);
          return _continue();
        };
        if (!(i < 10)) {
          return _break();
        } else {
          (function(__iced_k) {
            __iced_deferrals = new iced.Deferrals(__iced_k, {
              parent: ___iced_passed_deferral,
              filename: "test/iced.coffee"
            });
            delay(__iced_deferrals.defer({
              lineno: 556
            }));
            __iced_deferrals._fulfill();
          })(function() {
            j = 0;
            while (j < 10) {
              if (j === 5) break;
              j++;
            }
            return _next(i++);
          });
        }
      };
      _while(__iced_k);
    })(function() {
      res = j * i;
      return cb(res === 50, {});
    });
  });

  atest("defer and object assignment", function(cb) {
    var baz, i, out, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    baz = function(cb) {
      var ___iced_passed_deferral1, __iced_deferrals, __iced_k,
        _this = this;
      __iced_k = __iced_k_noop;
      ___iced_passed_deferral1 = iced.findDeferral(arguments);
      (function(__iced_k) {
        __iced_deferrals = new iced.Deferrals(__iced_k, {
          parent: ___iced_passed_deferral1,
          filename: "test/iced.coffee",
          funcname: "baz"
        });
        delay(__iced_deferrals.defer({
          lineno: 568
        }));
        __iced_deferrals._fulfill();
      })(function() {
        return cb({
          a: 1,
          b: 2,
          c: 3
        });
      });
    };
    out = [];
    (function(__iced_k) {
      var _i;
      __iced_deferrals = new iced.Deferrals(__iced_k, {
        parent: ___iced_passed_deferral,
        filename: "test/iced.coffee"
      });
      for (i = _i = 0; _i <= 2; i = ++_i) {
        switch (i) {
          case 0:
            baz(__iced_deferrals.defer({
              assign_fn: (function(__slot_1, __slot_2) {
                return function() {
                  return __slot_1[__slot_2] = arguments[0].c;
                };
              })(out, i),
              lineno: 574
            }));
            break;
          case 1:
            baz(__iced_deferrals.defer({
              assign_fn: (function(__slot_1, __slot_2) {
                return function() {
                  return __slot_1[__slot_2] = arguments[0].b;
                };
              })(out, i),
              lineno: 575
            }));
            break;
          case 2:
            baz(__iced_deferrals.defer({
              assign_fn: (function(__slot_1, __slot_2) {
                return function() {
                  return __slot_1[__slot_2] = arguments[0].a;
                };
              })(out, i),
              lineno: 576
            }));
        }
      }
      __iced_deferrals._fulfill();
    })(function() {
      return cb(out[0] === 3 && out[1] === 2 && out[2] === 1, {});
    });
  });

  atest('defer + arguments', function(cb) {
    var bar, x, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    bar = function(i, cb) {
      var ___iced_passed_deferral1, __iced_deferrals, __iced_k,
        _arguments = arguments,
        _this = this;
      __iced_k = __iced_k_noop;
      ___iced_passed_deferral1 = iced.findDeferral(arguments);
      (function(__iced_k) {
        __iced_deferrals = new iced.Deferrals(__iced_k, {
          parent: ___iced_passed_deferral1,
          filename: "test/iced.coffee",
          funcname: "bar"
        });
        delay(__iced_deferrals.defer({
          lineno: 581
        }));
        __iced_deferrals._fulfill();
      })(function() {
        return _arguments[1](_arguments[0]);
      });
    };
    (function(__iced_k) {
      __iced_deferrals = new iced.Deferrals(__iced_k, {
        parent: ___iced_passed_deferral,
        filename: "test/iced.coffee"
      });
      bar(10, __iced_deferrals.defer({
        assign_fn: (function() {
          return function() {
            return x = arguments[0];
          };
        })(),
        lineno: 584
      }));
      __iced_deferrals._fulfill();
    })(function() {
      return cb(10 === x, {});
    });
  });

  atest('autocb + wait + scoping problems', function(cb) {
    var fun1, fun2, x, y, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    fun1 = function(autocb) {
      var i, ___iced_passed_deferral1, __iced_deferrals, __iced_k,
        _this = this;
      __iced_k = autocb;
      ___iced_passed_deferral1 = iced.findDeferral(arguments);
      (function(__iced_k) {
        __iced_deferrals = new iced.Deferrals(__iced_k, {
          parent: ___iced_passed_deferral1,
          filename: "test/iced.coffee",
          funcname: "fun1"
        });
        delay(__iced_deferrals.defer({
          lineno: 590
        }));
        __iced_deferrals._fulfill();
      })(function() {
        var _i, _results, _while;
        i = 0;
        _results = [];
        _while = function(__iced_k) {
          var _break, _continue, _next;
          _break = function() {
            return __iced_k(_results);
          };
          _continue = function() {
            return iced.trampoline(function() {
              ++i;
              return _while(__iced_k);
            });
          };
          _next = function(__iced_next_arg) {
            _results.push(__iced_next_arg);
            return _continue();
          };
          if (!(i <= 10)) {
            return _break();
          } else {
            (function(__iced_k) {
              __iced_deferrals = new iced.Deferrals(__iced_k, {
                parent: ___iced_passed_deferral1,
                filename: "test/iced.coffee",
                funcname: "fun1"
              });
              delay(__iced_deferrals.defer({
                lineno: 592
              }));
              __iced_deferrals._fulfill();
            })(function() {
              return _next(1);
            });
          }
        };
        _while(__iced_k);
      });
    };
    fun2 = function(autocb) {
      var j, ___iced_passed_deferral1, __iced_deferrals, __iced_k,
        _this = this;
      __iced_k = autocb;
      ___iced_passed_deferral1 = iced.findDeferral(arguments);
      (function(__iced_k) {
        __iced_deferrals = new iced.Deferrals(__iced_k, {
          parent: ___iced_passed_deferral1,
          filename: "test/iced.coffee",
          funcname: "fun2"
        });
        delay(__iced_deferrals.defer({
          lineno: 595
        }));
        __iced_deferrals._fulfill();
      })(function() {
        var _i, _results, _while;
        j = 0;
        _results = [];
        _while = function(__iced_k) {
          var _break, _continue, _next;
          _break = function() {
            return __iced_k(_results);
          };
          _continue = function() {
            return iced.trampoline(function() {
              ++j;
              return _while(__iced_k);
            });
          };
          _next = function(__iced_next_arg) {
            _results.push(__iced_next_arg);
            return _continue();
          };
          if (!(j <= 2)) {
            return _break();
          } else {
            (function(__iced_k) {
              __iced_deferrals = new iced.Deferrals(__iced_k, {
                parent: ___iced_passed_deferral1,
                filename: "test/iced.coffee",
                funcname: "fun2"
              });
              delay(__iced_deferrals.defer({
                lineno: 597
              }));
              __iced_deferrals._fulfill();
            })(function() {
              return _next(2);
            });
          }
        };
        _while(__iced_k);
      });
    };
    (function(__iced_k) {
      __iced_deferrals = new iced.Deferrals(__iced_k, {
        parent: ___iced_passed_deferral,
        filename: "test/iced.coffee"
      });
      fun1(__iced_deferrals.defer({
        assign_fn: (function() {
          return function() {
            return x = arguments[0];
          };
        })(),
        lineno: 601
      }));
      fun2(__iced_deferrals.defer({
        assign_fn: (function() {
          return function() {
            return y = arguments[0];
          };
        })(),
        lineno: 602
      }));
      __iced_deferrals._fulfill();
    })(function() {
      return cb(x[0] === 1 && y[0] === 2, {});
    });
  });

  atest('for in by + await', function(cb) {
    var i, res, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    res = [];
    (function(__iced_k) {
      var _i, _results, _while;
      i = 0;
      _results = [];
      _while = function(__iced_k) {
        var _break, _continue, _next;
        _break = function() {
          return __iced_k(_results);
        };
        _continue = function() {
          return iced.trampoline(function() {
            i += 3;
            return _while(__iced_k);
          });
        };
        _next = function(__iced_next_arg) {
          _results.push(__iced_next_arg);
          return _continue();
        };
        if (!(i <= 10)) {
          return _break();
        } else {
          (function(__iced_k) {
            __iced_deferrals = new iced.Deferrals(__iced_k, {
              parent: ___iced_passed_deferral,
              filename: "test/iced.coffee"
            });
            delay(__iced_deferrals.defer({
              lineno: 608
            }));
            __iced_deferrals._fulfill();
          })(function() {
            return _next(res.push(i));
          });
        }
      };
      _while(__iced_k);
    })(function() {
      return cb(res.length === 4 && res[3] === 9, {});
    });
  });

  atest('super after await', function(cb) {
    var A, B, b, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    A = (function() {

      function A() {
        this._i = 0;
      }

      A.prototype.foo = function(cb) {
        var ___iced_passed_deferral1, __iced_deferrals, __iced_k,
          _this = this;
        __iced_k = __iced_k_noop;
        ___iced_passed_deferral1 = iced.findDeferral(arguments);
        (function(__iced_k) {
          __iced_deferrals = new iced.Deferrals(__iced_k, {
            parent: ___iced_passed_deferral1,
            filename: "test/iced.coffee",
            funcname: "A.foo"
          });
          delay(__iced_deferrals.defer({
            lineno: 618
          }));
          __iced_deferrals._fulfill();
        })(function() {
          _this._i += 1;
          return cb();
        });
      };

      return A;

    })();
    B = (function(_super) {

      __extends(B, _super);

      function B() {
        B.__super__.constructor.apply(this, arguments);
      }

      B.prototype.foo = function(cb) {
        var ___iced_passed_deferral1, __iced_deferrals, __iced_k,
          _this = this;
        __iced_k = __iced_k_noop;
        ___iced_passed_deferral1 = iced.findDeferral(arguments);
        (function(__iced_k) {
          __iced_deferrals = new iced.Deferrals(__iced_k, {
            parent: ___iced_passed_deferral1,
            filename: "test/iced.coffee",
            funcname: "B.foo"
          });
          delay(__iced_deferrals.defer({
            lineno: 625
          }));
          __iced_deferrals._fulfill();
        })(function() {
          (function(__iced_k) {
            __iced_deferrals = new iced.Deferrals(__iced_k, {
              parent: ___iced_passed_deferral1,
              filename: "test/iced.coffee",
              funcname: "B.foo"
            });
            delay(__iced_deferrals.defer({
              lineno: 626
            }));
            __iced_deferrals._fulfill();
          })(function() {
            _this._i += 2;
            return B.__super__.foo.call(_this, cb);
          });
        });
      };

      return B;

    })(A);
    b = new B();
    (function(__iced_k) {
      __iced_deferrals = new iced.Deferrals(__iced_k, {
        parent: ___iced_passed_deferral,
        filename: "test/iced.coffee"
      });
      b.foo(__iced_deferrals.defer({
        lineno: 630
      }));
      __iced_deferrals._fulfill();
    })(function() {
      return cb(b._i === 3, {});
    });
  });

  atest('more for + when (Issue #38 via @boris-petrov)', function(cb) {
    var bar, o, x, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    x = 'x';
    bar = {
      b: 1
    };
    (function(__iced_k) {
      var _i, _len, _ref, _results, _while;
      _ref = [
        {
          p: 'a'
        }, {
          p: 'b'
        }
      ];
      _len = _ref.length;
      _i = 0;
      _results = [];
      _while = function(__iced_k) {
        var _break, _continue, _next;
        _break = function() {
          return __iced_k(_results);
        };
        _continue = function() {
          return iced.trampoline(function() {
            ++_i;
            return _while(__iced_k);
          });
        };
        _next = function(__iced_next_arg) {
          _results.push(__iced_next_arg);
          return _continue();
        };
        if (!(_i < _len)) {
          return _break();
        } else {
          o = _ref[_i];
          if (bar[o.p] != null) {
            (function(__iced_k) {
              __iced_deferrals = new iced.Deferrals(__iced_k, {
                parent: ___iced_passed_deferral,
                filename: "test/iced.coffee"
              });
              delay(__iced_deferrals.defer({
                lineno: 637
              }));
              __iced_deferrals._fulfill();
            })(function() {
              return _next(x = o.p);
            });
          } else {
            return _continue();
          }
        }
      };
      _while(__iced_k);
    })(function() {
      return cb(x === 'b', {});
    });
  });

  atest('for + ...', function(cb) {
    var i, inc, x, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    x = 0;
    inc = function() {
      return x++;
    };
    (function(__iced_k) {
      var _i, _results, _while;
      i = 0;
      _results = [];
      _while = function(__iced_k) {
        var _break, _continue, _next;
        _break = function() {
          return __iced_k(_results);
        };
        _continue = function() {
          return iced.trampoline(function() {
            ++i;
            return _while(__iced_k);
          });
        };
        _next = function(__iced_next_arg) {
          _results.push(__iced_next_arg);
          return _continue();
        };
        if (!(i < 10)) {
          return _break();
        } else {
          (function(__iced_k) {
            __iced_deferrals = new iced.Deferrals(__iced_k, {
              parent: ___iced_passed_deferral,
              filename: "test/iced.coffee"
            });
            delay(__iced_deferrals.defer({
              lineno: 646
            }), 0);
            __iced_deferrals._fulfill();
          })(function() {
            return _next(inc());
          });
        }
      };
      _while(__iced_k);
    })(function() {
      return cb(x === 10, {});
    });
  });

  atest('test a stack attack', function(cb) {
    var i, ___iced_passed_deferral, __iced_deferrals, __iced_k,
      _this = this;
    __iced_k = __iced_k_noop;
    ___iced_passed_deferral = iced.findDeferral(arguments);
    console.log("AAA");
    (function(__iced_k) {
      var _i, _results, _while;
      i = 0;
      _results = [];
      _while = function(__iced_k) {
        var _break, _continue, _next;
        _break = function() {
          return __iced_k(_results);
        };
        _continue = function() {
          return iced.trampoline(function() {
            ++i;
            return _while(__iced_k);
          });
        };
        _next = function(__iced_next_arg) {
          _results.push(__iced_next_arg);
          return _continue();
        };
        if (!(i <= 10000)) {
          return _break();
        } else {
          (function(__iced_k) {
            if (i % 5000 === 0) {
              (function(__iced_k) {
                __iced_deferrals = new iced.Deferrals(__iced_k, {
                  parent: ___iced_passed_deferral,
                  filename: "test/iced.coffee"
                });
                delay(__iced_deferrals.defer({
                  lineno: 654
                }), 0);
                __iced_deferrals._fulfill();
              })(__iced_k);
            } else {
              return __iced_k();
            }
          })(function() {
            return _next(console.log(i));
          });
        }
      };
      _while(__iced_k);
    })(function() {
      return cb(true, {});
    });
  });

}).call(this);
